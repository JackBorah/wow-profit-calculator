{% extends "base_template.html" %}

{% block body %}
    {% load static %}
    <h1>{{ name }}</h1>

    <main>
      <h3 id="crafting_stats_header">Crafting Stats (whole number)</h3>
      <div id="crafting_stats">
        {% if product.inspirable %}
        <div id="inspiration">
          <h4>Inspiration</h4>
          <div id="base_inspiration_container">
            <label for="base_inspiration">Base</label>
            <input type="number" id="base_inspiration"  value="{{ inspiration }}">
          </div>
          <div id="optional_inspiration_container">
            <label for="inspiration_optional">From Optional Materials</label>
            <input type="number" id="inspiration_optional"  value="{{ inspiration }}" readonly>
          </div>
          <div id="total_inspiration_container">
            <label for="total_inspiration">Total</label>
            <input type="number" id="total_inspiration"  value="{{ inspiration }}">
          </div>
        </div>
        {% endif %}
        
        <div id="resourcefulness">
          <h4>Resourcefulness</h4>
          <div>
            <label for="base_resourcefulness">Base</label>
            <input type="number" id="base_resourcefulness"  value="{{ inspiration }}">
          </div>
          <div>
            <label for="resourcefulness_optional">From Optional Materials</label>
            <input type="number" id="resourcefulness_optional"  value="{{ inspiration }}" readonly>
          </div>
          <div>
            <label for="total_resourcefulness">Total</label>
            <input type="number" id="total_resourcefulness"  value="{{ resourcefulness }}">
          </div>
        </div>

        {% if product.multicraftable %}
        <div id="multicraft">
          <h4>Multicraft</h4>
          <div>
            <label for="base_multicraft">Base</label>
            <input type="number" id="base_multicraft"  value="{{ inspiration }}">
          </div>
          <div>
            <label for="multicraft_optional">From Optional Materials</label>
            <input type="number" id="multicraft_optional"  value="{{ inspiration }}" readonly>
          </div>
          <div>
            <label for="total_multicraft">Total</label>
            <input type="number" id="total_multicraft"  value="{{ multicraft }}">
          </div>
        </div>
        {% endif %}
      </div>

      <h3>Materials</h4>
      <div id="materials">
        {% for mat in mats %}
          <div id="mat_{{ forloop.counter0 }}" class="optional_mat_slot_container">
            <label>{{ mat.name }} x <span class="matQuantity">{{ mat.quantity }}</span></label>
            {% comment %} {% if mat.tiers.0.num %} <!--What does this check for?-->
            <label for="mat_{{ forloop.counter }}_select">Tier</label>
            <select id="mat_{{ forloop.counter }}_select" matindex="{{ forloop.counter0 }}">
              {% for tier in mat.tiers %}
              <option value="{{ tier.num }}">{{ tier.num }}</option>
              {% endfor %}
            </select>
            {% endif %} {% endcomment %}
            <input type="number" id="mat_{{ forloop.counter0 }}_input" class="mat_input" value="{{mat.tiers.0.buyout}}"/>
          </div>
        {% endfor %}
      </div>

      {% if optional_mat_slots %}
      <h3>Optional Materials</h4>
      <div id="optional_materials">
        {% if product.inspirable %}
        <div id="sagacious_incense_container" class="optional_mat_slot_container">
          <label for="sagacious_incense">Sagacious Incense +20</label>
          <div>
          <input type="checkbox" id="sagacious_incense"  value="20">
          <input id="sagacious_incense_input" type="number" value=0>
          </div>
        </div>
        {% endif %}
        {% for optional_mat_slot in optional_mat_slots %}
        <div id="optional_mat_slot_{{ forloop.counter0 }}" class="optional_mat_slot_container">
          <label for="optional_mat_slot_{{ forloop.counter0 }}_checkbox"> {{ optional_mat_slot.name }} x <span class="optional_mat_quantity">{{ optional_mat_slot.quantity }}</span></label>
          <div>
          <input type="checkbox" id="optional_mat_slot_{{ forloop.counter0 }}_checkbox" class="optional_mat_slot_checkbox" matindex="{{ forloop.counter0 }}">
          <label for="optional_mat_slot_{{ forloop.counter0 }}_select">Items</label>
          <select id="optional_mat_{{ forloop.counter0 }}_select" matindex="{{ forloop.counter0 }}" class="optional_mat_slot_select">
            {% for category in optional_mat_slot.categories %}
              <optgroup label="{{ category.name }}" optgroupindex={{ forloop.counter0 }}>
                {% for item in category.items %}
                  <option value="{{ item.quality }}" data-inspiration="{{ item.Inspiration }}" data-multicraft="{{ item.Multicraft }}" data-resourcefulness="{{ item.Resourcefulness }}">
                    {{ item.quality }}
                  </option>
                {% endfor %}
              </optgroup>
            {% endfor %}
          </select>

          <input type="number" id="optional_mat_{{ forloop.counter0 }}_input" class="optional_mat"  value="{{ optional_mat_slot.categories.0.items.0.buyout }}" matindex="{{ forloop.counter0 }}"/>
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <h3>Product x<span id="product_quantity">{{ product.quantity }}</span></h3>
      <div id="product_elements">
        {% if product.inspirable %}
          <label for="product_input">Tier</label>
          {% comment %} <select id="product_select">
            {% for tier in product.tiers %}
              <option value="{{ tier.num }}">{{ tier.num }}</option>
            {% endfor %}
          </select> {% endcomment %}
        {% endif %}
        <input type="number" id="product_input"  value="{{ product.tiers.0.buyout }}"/>
        
        {% if product.inspirable %}
        <label for="inspired_product_input">Tier when inspired</label>
        {% comment %} <select id="inspired_product_select"> used when skill calculation is built
          {% for tier in product.tiers %}
            <option value="{{ tier.num }}">{{ tier.num }}</option>
          {% endfor %}
        </select> {% endcomment %}
        <input type="number" id="inspired_product_input"  value="{{ product.tiers.0.buyout }}"/>
        {% endif %}
      </div>

      <h3>Cost</h3>
      <div id="cost_elements">
        <input type="number" id="cost" value="0"/>
      </div>
      <h3>Average Product Value</h3>
      <div id="avg_product_elements">
        <input type="number" id="avgerage_value_input" value="0">
      </div>
      <h3>Profit</h3>
      <div id="profit_elements">
        <input type="number" id="profit" value="0"/>
      </div>

    
      {{ mats|json_script:"mats" }}
      {{ optional_mat_slots|json_script:"optional_mat_slots" }}
      {{ product|json_script:"product" }}
      {{ recipe_skill|json_script:"recipe_skill"}}
      <script src={% static 'calculator/calculatePL.js' %}></script>
    </main>
{% endblock %}
